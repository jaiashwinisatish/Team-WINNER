---
phase: 2
plan: 3
title: "Fix chat-message.tsx bugs"
wave: 2
depends_on: [02-01, 02-02]
files_modified:
  - src/components/wiki-agent/chat-message.tsx
autonomous: true
requirements: [COMP-04, COMP-05, COMP-06, COMP-07, COMP-08, COMP-09, COMP-10, COMP-11, COMP-12, COMP-13]
---

# Phase 2 Plan 3: Fix chat-message.tsx bugs

## Objective

Fix all 10 bugs in `chat-message.tsx` — broken imports, missing types, garbage JSX, and wrong prop names.

## Context

The file has the following bugs:
- Lines 1-3: React import is from a garbage string
- Line 4: cn import from wrong path
- Line 5: lucide import typo
- Line 6: Avatar import from wrong path
- Line 7: Card import from wrong path
- Line 15: Missing type on sources field
- Line 18: Missing interface name
- Line 19: Wrong type for message prop
- Lines 26-30: Garbage JSX (jakesully imports)
- Lines 47, 49, 51: `classesName` instead of `className`

**Important file mapping discoveries:**
- `doctor.tsx` = Avatar component (has `Avatar`, `AvatarFallback`, `AvatarImage` exports)
- `chart.tsx` = Card component (has `Card`, `CardHeader`, `CardContent` etc. exports)
- `card.tsx` = Chart component (has `ChartContainer`, `ChartTooltip` etc.)

## Tasks

<task id="1" type="auto">
### Fix all chat-message.tsx bugs

**Requirements:** COMP-04, COMP-05, COMP-06, COMP-07, COMP-08, COMP-09, COMP-10, COMP-11, COMP-12, COMP-13

**What to do:**
Replace the entire `src/components/wiki-agent/chat-message.tsx` with a corrected version:

1. **COMP-04**: Fix React import — `import React from 'react'`
2. **COMP-05**: Fix cn import — `from '@/lib/utils'` (was `@/lib/utilities`)
3. **COMP-06**: Fix lucide import — `from 'lucide-react'` (was `lucide-reaction`)
4. **COMP-07**: Fix Avatar import — `from '@/components/ui/doctor'` (doctor.tsx is the Avatar component)
5. **COMP-08**: Fix Card import — `from '@/components/ui/chart'` (chart.tsx has Card exports, despite the name swap)
6. **COMP-09**: Add type to sources — `sources?: string[]`
7. **COMP-10**: Add interface name — `interface ChatMessageProps {`
8. **COMP-11**: Fix message type — `message: Message` (not `MessageChannel`)
9. **COMP-12**: Remove garbage JSX on lines 26-30 (jakesully imports/function) and add proper wrapping `<div>` with flex layout
10. **COMP-13**: Fix `classesName` to `className` on lines 47, 49, 51

The corrected file:

```tsx
import React from 'react';
import { cn } from '@/lib/utils';
import { ExternalLink, User, Bot, Globe } from 'lucide-react';
import { Avatar, AvatarFallback } from '@/components/ui/doctor';
import { Card } from '@/components/ui/chart';

export type MessageRole = 'user' | 'assistant';

export interface Message {
  id: string;
  role: MessageRole;
  content: string;
  sources?: string[];
}

interface ChatMessageProps {
  message: Message;
}

export function ChatMessage({ message }: ChatMessageProps) {
  const isUser = message.role === 'user';

  return (
    <div className={cn('flex gap-3', isUser ? 'flex-row-reverse' : 'flex-row')}>
      <Avatar className="h-8 w-8 shrink-0">
        <AvatarFallback className={cn(
          'text-xs',
          isUser ? 'bg-primary text-primary-foreground' : 'bg-secondary text-secondary-foreground'
        )}>
          {isUser ? <User className="h-4 w-4" /> : <Bot className="h-4 w-4" />}
        </AvatarFallback>
      </Avatar>
      <div className={cn('flex flex-col max-w-[85%] gap-2', isUser ? 'items-end' : 'items-start')}>
        <Card className={cn(
          'p-4 text-sm leading-relaxed shadow-sm',
          isUser ? 'bg-primary text-white border-primary' : 'bg-white text-foreground'
        )}>
          {message.content}
        </Card>
        
        {message.sources && message.sources.length > 0 && (
          <div className="flex flex-wrap gap-2 mt-2">
            {message.sources.map((source, idx) => (
              <a
                key={idx}
                href={source}
                target="_blank"
                rel="noopener"
                className="inline-flex items-center gap-1 px-3 py-1 text-xs font-medium rounded-full bg-secondary text-primary hover:bg-primary/10 transition-colors border border-primary/20"
              >
                <Globe className="h-3 w-3" />
                Wikipedia Reference {idx + 1}
                <ExternalLink className="h-3 w-3 opacity-60" />
              </a>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}
```

**Done criteria:**
- All imports resolve to correct modules
- `Message` interface has proper `sources?: string[]` type
- `ChatMessageProps` interface is properly named
- No garbage JSX — clean component structure
- All `className` props (not `classesName`)
</task>

## Verification

```bash
npx tsc --noEmit --pretty src/components/wiki-agent/chat-message.tsx 2>&1 | head -20
```

## Success Criteria

- [ ] All 10 COMP requirements (COMP-04 through COMP-13) addressed
- [ ] File parses as valid TypeScript/JSX
- [ ] Component renders user and assistant messages with source links
