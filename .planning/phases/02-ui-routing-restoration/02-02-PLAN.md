---
phase: 2
plan: 2
title: "Rebuild page.tsx and chat-container.tsx from scratch"
wave: 1
depends_on: []
files_modified:
  - src/app/page.tsx
  - src/components/wiki-agent/chat-container.tsx
autonomous: true
requirements: [COMP-01, COMP-02]
---

# Phase 2 Plan 2: Rebuild page.tsx and chat-container.tsx

## Objective

Replace the two ASCII-art-wiped files with clean, functional implementations based on the WikiAgent blueprint and the existing `chat-message.tsx` interface.

## Context

- `page.tsx` (324 lines ASCII art) — must become the WikiAgent main page with question input and message display
- `chat-container.tsx` (324 lines ASCII art) — must become the ChatContainer component for scrollable chat
- The blueprint specifies: question input, AI agent answering, source linking, chat interface
- `chat-message.tsx` exports `Message` type with `id`, `role`, `content`, `sources?` and `ChatMessage` component
- The Card component is available at `@/components/ui/chart` (the card and chart code got swapped by the saboteur — chart.tsx contains Card exports)
- The Button component is at `@/components/ui/mohammad` (renamed)
- The Input component is at `@/components/ui/output` (renamed)
- The ScrollArea component is at `@/components/ui/scroll-area`

## Tasks

<task id="1" type="auto">
### Rebuild chat-container.tsx — Scrollable chat message container

**Requirements:** COMP-02

**What to do:**
Delete ALL ASCII art content and create a clean ChatContainer component:

```tsx
'use client';

import React, { useRef, useEffect } from 'react';
import { ScrollArea } from '@/components/ui/scroll-area';
import { ChatMessage, Message } from '@/components/wiki-agent/chat-message';
import { cn } from '@/lib/utils';

interface ChatContainerProps {
  messages: Message[];
  className?: string;
}

export function ChatContainer({ messages, className }: ChatContainerProps) {
  const bottomRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  return (
    <ScrollArea className={cn('flex-1 p-4', className)}>
      <div className="flex flex-col gap-4 max-w-3xl mx-auto">
        {messages.length === 0 ? (
          <div className="flex flex-col items-center justify-center py-12 text-muted-foreground">
            <p className="text-lg font-medium">Ask WikiAgent a question</p>
            <p className="text-sm">Get factual answers powered by Wikipedia</p>
          </div>
        ) : (
          messages.map((message) => (
            <ChatMessage key={message.id} message={message} />
          ))
        )}
        <div ref={bottomRef} />
      </div>
    </ScrollArea>
  );
}
```

**Done criteria:**
- Component accepts `messages: Message[]` prop
- Renders ChatMessage for each message
- Auto-scrolls to bottom on new messages
- Shows empty state when no messages
</task>

<task id="2" type="auto">
### Rebuild page.tsx — WikiAgent main page

**Requirements:** COMP-01

**What to do:**
Delete ALL ASCII art content and create the WikiAgent main page:

The page should:
1. Be a `'use client'` component (it manages local state for messages)
2. Import `ChatContainer` from `@/components/wiki-agent/chat-container`
3. Import `Message` type from `@/components/wiki-agent/chat-message`
4. Maintain `messages` state as `Message[]`
5. Have a text input for questions with a Send button
6. On form submit: add user message, call the AI flow via `/api/chat` or directly invoke the genkit flow (for now, just add the user message — Phase 3 connects the AI)
7. Display header with "WikiAgent" branding
8. Use the ChatContainer to display messages
9. Have a fixed input area at the bottom

```tsx
'use client';

import React, { useState, FormEvent } from 'react';
import { ChatContainer } from '@/components/wiki-agent/chat-container';
import { Message } from '@/components/wiki-agent/chat-message';
import { Send, Globe } from 'lucide-react';

export default function WikiAgentPage() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    if (!input.trim() || isLoading) return;

    const userMessage: Message = {
      id: crypto.randomUUID(),
      role: 'user',
      content: input.trim(),
    };

    setMessages((prev) => [...prev, userMessage]);
    setInput('');
    setIsLoading(true);

    // TODO: Phase 3 will connect this to the Genkit AI flow
    // For now, add a placeholder response
    const assistantMessage: Message = {
      id: crypto.randomUUID(),
      role: 'assistant',
      content: 'WikiAgent is being connected to the AI backend. This will be functional after Phase 3.',
    };

    setTimeout(() => {
      setMessages((prev) => [...prev, assistantMessage]);
      setIsLoading(false);
    }, 500);
  };

  return (
    <div className="flex flex-col h-screen bg-background">
      {/* Header */}
      <header className="flex items-center gap-3 px-6 py-4 border-b bg-card">
        <Globe className="h-6 w-6 text-primary" />
        <div>
          <h1 className="text-xl font-semibold text-foreground">WikiAgent</h1>
          <p className="text-xs text-muted-foreground">AI-Powered Wikipedia Assistant</p>
        </div>
      </header>

      {/* Chat Area */}
      <ChatContainer messages={messages} className="flex-1" />

      {/* Input Area */}
      <div className="border-t bg-card p-4">
        <form onSubmit={handleSubmit} className="flex gap-2 max-w-3xl mx-auto">
          <input
            type="text"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="Ask a question about anything..."
            className="flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
            disabled={isLoading}
          />
          <button
            type="submit"
            disabled={isLoading || !input.trim()}
            className="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:pointer-events-none disabled:opacity-50 transition-colors"
          >
            <Send className="h-4 w-4" />
          </button>
        </form>
      </div>
    </div>
  );
}
```

**Done criteria:**
- Page renders header with WikiAgent branding
- ChatContainer displays messages
- Input field accepts text and submits on Enter
- User messages appear in chat
- Placeholder assistant response works (Phase 3 wires real AI)
</task>

## Verification

```bash
# Check both files parse
npx tsc --noEmit --pretty src/app/page.tsx 2>&1 | head -20
npx tsc --noEmit --pretty src/components/wiki-agent/chat-container.tsx 2>&1 | head -20
```

## Success Criteria

- [ ] `page.tsx` renders a functional WikiAgent chat interface
- [ ] `chat-container.tsx` provides scrollable message rendering
- [ ] Both files are valid TypeScript/JSX with no ASCII art
